# Руководство по проекту Drones

## Описание проекта

Проект представляет собой веб-приложение для компании ООО "ЛЕГИОН", специализирующейся на строительно-монтажных работах. Приложение включает в себя:

- Главную страницу с описанием услуг
- Каталог услуг с возможностью заказа
- Контактную информацию
- Формы обратной связи с интеграцией с Telegram ботом

## Стек технологий

- React Router v7
- TypeScript
- Tailwind CSS
- Node.js
- Express
- Nginx (в качестве прокси-сервера)
- Axios (для HTTP-запросов)

## Структура проекта

```
Drones/
├── app/                    # Исходники React-приложения
├── build/                  # Собранные файлы
├── public/                 # Публичные ресурсы
├── src/                    # Дополнительные исходники
├── server.js               # Основной сервер (порт 3000)
├── api-server.js           # API-сервер для Telegram-интеграции (порт 3001)
├── .env                    # Файл с переменными окружения
├── package.json            # Зависимости и скрипты
└── ...
```

## Переменные окружения

Создайте файл `.env` в корне проекта:

```env
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_CHAT_ID=ваш_id_чата

# Server Port
PORT=3000
```

## Установка и запуск

### 1. Установка зависимостей

```bash
npm install
```

### 2. Сборка проекта

```bash
npm run build
```

### 3. Запуск серверов

#### Вариант 1: Использование скрипта (рекомендуется)

```bash
# Запуск скрипта перезапуска серверов
./restart-servers.sh
```

#### Вариант 2: Ручной запуск

```bash
# Запуск основного сервера (порт 3000)
node server.js

# Запуск API-сервера (порт 3001)
node api-server.js
```

## Архитектура серверов

### Основной сервер (порт 3000)
- Обслуживает веб-интерфейс
- Обрабатывает все маршруты приложения
- Расположен в файле `server.js`

### API-сервер (порт 3001)
- Обрабатывает запросы к Telegram-боту
- Принимает POST-запросы на `/api/telegram-webhook`
- Расположен в файле `api-server.js`

### Nginx (прокси-сервер)
- Проксирует запросы к `/api/telegram-webhook` на порт 3001
- Проксирует остальные запросы на порт 3000
- Обеспечивает HTTPS-соединение

## Интеграция с Telegram

### Настройка Telegram бота

1. Найдите в Telegram бота @BotFather
2. Отправьте ему команду `/newbot`
3. Следуйте инструкциям для создания нового бота
4. После создания BotFather предоставит вам токен для бота
5. Найдите в Telegram бота @userinfobot и отправьте ему любое сообщение, чтобы получить ваш ID чата
6. Добавьте токен и ID чата в файл `.env`

### Формы обратной связи

#### На странице контактов
- Форма отправляет данные на `/api/telegram-webhook`
- Сообщение включает имя, email, телефон и сообщение пользователя

#### В каталоге услуг
- При нажатии на кнопку "Заказать" открывается модальное окно
- Форма отправляет данные на тот же эндпоинт `/api/telegram-webhook`
- К сообщению добавляется информация о заказываемой услуге

## Команды для управления

### Сборка проекта
```bash
npm run build
```

### Запуск в режиме разработки
```bash
npm run dev
```

### Перезапуск серверов
```bash
./restart-servers.sh
```

### Проверка состояния процессов
```bash
ps aux | grep node
```

### Проверка состояния nginx
```bash
sudo systemctl status nginx
```

### Проверка конфигурации nginx
```bash
sudo nginx -t
```

### Перезапуск nginx
```bash
sudo systemctl reload nginx
```

## Управление логами

### Логи основного сервера
- Файл: `server.log` (создается при запуске через скрипт)

### Логи API-сервера
- Файл: `api-server.log` (создается при запуске через скрипт)

## Возможные проблемы и решения

### 1. Ошибка 502 Bad Gateway
- Проверьте, что оба сервера запущены (порт 3000 и 3001)
- Проверьте конфигурацию nginx

### 2. Ошибка CORS
- Убедитесь, что nginx правильно настроен для проксирования запросов
- Проверьте, что эндпоинты доступны по HTTPS

### 3. Ошибка "Failed to fetch"
- Проверьте, что URL запроса корректен
- Убедитесь, что сервера запущены и доступны

### 4. Проблемы с Telegram-ботом
- Проверьте, что токен бота и ID чата указаны правильно в `.env`
- Убедитесь, что бот активен и может получать сообщения

## Деплой

Для деплоя на сервере:

1. Обновите код из репозитория:
```bash
git pull origin main
```

2. Установите зависимости:
```bash
npm install
```

3. Соберите проект:
```bash
npm run build
```

4. Перезапустите серверы:
```bash
./restart-servers.sh
```

## Структура каталога услуг

Каталог включает в себя 17 услуг в 6 категориях:
- Подготовительные работы
- Монтаж металлических конструкций
- Работы по устройству каменных конструкций и отделочные работы
- Устройство монолитных и сборных бетонных и железобетонных конструкций
- Теплоизоляционные работы
- Дополнительные услуги

Каждая услуга имеет:
- Название и описание
- Категорию
- Детали услуги
- Изображение (если доступно)
- Кнопку "Заказать" для открытия модального окна

## Безопасность

- Все внешние соединения осуществляются по HTTPS
- Персональные данные обрабатываются в соответствии с политикой конфиденциальности
- Токены и ключи хранятся в переменных окружения и не коммитятся в репозиторий